---
title: "STAT447-fa22-final"
author: "Ziyue Yang"
date: "2022-12-04"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import data and Data cleaning

Import data from database file

```{r import data}
raw_data=data.table::fread('globalterrorismdb_0221dist.csv')
dim(raw_data)
```

### Do data cleaning

Original data have 136 features

```{r}
str(raw_data)
```

After analysis we pick 14 feature as shown below:

```{r}
#selected = raw_data[,c('gname','country','success','suicide','attacktype1','targtype1','claimed','weaptype1','nkill','nwound','property','ransom'),]
selected = raw_data[,c('gname','country','latitude','longitude','success','suicide','attacktype1','targtype1','claimed','weaptype1','nkill','nwound','property','ransom'),]
```

Also, there are lots of terrorist groups, and most of them have few records. We believe activate groups can be great threats to the world. In this project, we find the most active ùëò terrorist groups by amount of attacks their launched.

```{r}
group = as.data.frame(table(selected$gname))
tail(head(group[order(-group$Freq),],11),10)
```

As table shown above, we focus on these most active ùëò terrorist groups in next analysis.\

```{r}
groups_name=as.character(head(group[order(-group$Freq),"Var1"],11))
groups_name=tail(groups_name,10)
groups_name
```

```{r}
selected = selected[gname%in%groups_name,,]
str(selected)
```

```{r}
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}
```

Convert all NA to 0.

```{r}
selected[is.na(selected)] <- 0
str(selected)
```

## KNN

```{r}
#Install class package
install.packages('class')
# Load class package
library(class)
```

### Data splitting

Randomly select 70% data as training set.

```{r}
set.seed(123)
#random selection of 70% data.
index = sample(1:nrow(selected),size=nrow(selected)*0.7,replace = FALSE)
train_labels = selected[index,gname]
test_labels = selected[-index,gname]
selected <- as.data.frame(lapply(selected[,2:NCOL(selected)], normalize))
train = selected[index,]
test = selected[-index,]
```

### Training

```{r}
#Find the number of observation
NROW(train_labels)
```

Since $\sqrt{30263}\approx175$, we set K value of our model as 175.

```{r}
model = knn(train=train, test=test, cl=train_labels, k=175)
ACC <- 100 * sum(test_labels == model)/NROW(test_labels)
ACC
```
